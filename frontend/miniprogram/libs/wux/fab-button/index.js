"use strict";var _baseComponent=_interopRequireDefault(require("../helpers/baseComponent")),_classNames5=_interopRequireDefault(require("../helpers/classNames"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function ownKeys(e,t){var a,n=Object.keys(e);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(e),t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)),n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach(function(t){_defineProperty(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var defaultAction="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAQAAAAAYLlVAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAHdElNRQfhBAQLCR5MtjrbAAAAjUlEQVRo3u3ZMRKAIAxEUbDirp4nXnctFFDHBtDQ/O1Nnk6aHUMgZCBKMkmmNAtgOmL9M+IQQGVM95zljy8DAAAAAAAAAAAAAACALsDZcppSx7Q+WdtUvA5xffUtrjeA8/qQ21S9gc15/3Nfzw0M5O0G2kM5BQAAAAAAAAAAAAAAQGk33q0qZ/p/Q/JFdmei9usomnwIAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE3LTA0LTA0VDExOjA5OjMwKzA4OjAw1U4c3wAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNy0wNC0wNFQxMTowOTozMCswODowMKQTpGMAAAAASUVORK5CYII=",setTransform=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:300,n=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],a="transition-duration: ".concat(a,"ms"),t="transform: scale(".concat(e,") translate3d(").concat(n?t:0,"px, ").concat(n?0:t,"px, 0)");return"opacity: 1; ".concat(a,"; ").concat(t)};(0,_baseComponent.default)({properties:{prefixCls:{type:String,value:"wux-fab-button"},hoverClass:{type:String,value:"default"},theme:{type:String,value:"balanced"},position:{type:String,value:"bottomRight"},action:{type:String,value:defaultAction},actionRotate:{type:Boolean,value:!0},hideShadow:{type:Boolean,value:!1},backdrop:{type:Boolean,value:!1},buttons:{type:Array,value:[],observer:"forceUpdateButtonStyle"},direction:{type:String,value:"horizontal",observer:"forceUpdateButtonStyle"},spaceBetween:{type:Number,value:10,observer:"forceUpdateButtonStyle"},duration:{type:Number,value:300},scale:{type:Number,value:.9,observer:"forceUpdateButtonStyle"},reverse:{type:Boolean,value:!1,observer:"forceUpdateButtonStyle"},sAngle:{type:Number,value:0,observer:"forceUpdateButtonStyle"},eAngle:{type:Number,value:360,observer:"forceUpdateButtonStyle"},defaultVisible:{type:Boolean,value:!1},visible:{type:Boolean,value:!1,observer:function(t){this.data.controlled&&this.updated(t)}},controlled:{type:Boolean,value:!1}},data:{buttonStyle:[],buttonVisible:!1},computed:{classes:["prefixCls, position, theme, direction, reverse, buttonVisible, hideShadow, actionRotate, buttons, hoverClass",function(a,t,e,n,o,r,c,i,s,l){var u;return{wrap:(0,_classNames5.default)(a,(_defineProperty(u={},"".concat(a,"--").concat(t),t),_defineProperty(u,"".concat(a,"--").concat(e),e),_defineProperty(u,"".concat(a,"--").concat(n),n),_defineProperty(u,"".concat(a,"--reverse"),o),_defineProperty(u,"".concat(a,"--opened"),r),u)),action:(0,_classNames5.default)("".concat(a,"__action"),_defineProperty({},"".concat(a,"__action--hide-shadow"),c)),text:(0,_classNames5.default)("".concat(a,"__text"),_defineProperty({},"".concat(a,"__text--rotate"),r&&i)),button:s.map(function(t){var e;return{wrap:(0,_classNames5.default)("".concat(a,"__button"),(_defineProperty(e={},"".concat(a,"__button--hide-shadow"),t.hideShadow),_defineProperty(e,"".concat(a,"__button--disabled"),t.disabled),_defineProperty(e,"".concat(t.className),t.className),e)),hover:t.hoverClass&&"default"!==t.hoverClass?t.hoverClass:"".concat(a,"__button--hover")}}),icon:"".concat(a,"__icon"),label:"".concat(a,"__label"),backdrop:"".concat(a,"__backdrop"),hover:l&&"default"!==l?l:"".concat(a,"--hover")}}]},methods:{updated:function(t){this.data.buttonVisible!==t&&(this.setData({buttonVisible:t}),this.updateButtonStyle(!t))},onChange:function(t){this.data.controlled||this.updated(t),this.triggerEvent("change",{value:t})},onToggle:function(){this.onChange(!this.data.buttonVisible)},onTap:function(t){var e=t.currentTarget.dataset,t=e.index,e=e.value,t={index:t,value:e,buttons:this.data.buttons};e.disabled||(this.triggerEvent("click",t),this.onChange(!1))},getRect:function(t,a){var n=this;return new Promise(function(e){wx.createSelectorQuery().in(n)[a?"selectAll":"select"](t).boundingClientRect(function(t){a&&Array.isArray(t)&&t.length&&e(t),!a&&t&&e(t)}).exec()})},forceUpdateButtonStyle:function(){this.updateButtonStyle(!this.data.buttonVisible)},updateButtonStyle:function(t){var o=this,e=this.data,a=e.prefixCls,r=e.buttons,c=e.duration,i=e.direction,s=e.spaceBetween,l=e.scale,u=[],d=this.data.reverse?1:-1,A="horizontal"===i;if(t)return r.forEach(function(){u.push("opacity: 0; transform: translate3d(0, 0, 0)")}),void(this.data.buttonStyle!==u&&this.setData({buttonStyle:u}));this.getRect(".".concat(a,"__action")).then(function(a){switch(i){case"horizontal":case"vertical":r.forEach(function(t,e){e="".concat(d*(a.width+s)*(e+1)),e=setTransform(e,l,c,A);u.push(e)});break;case"circle":var n=a.width+s;r.forEach(function(t,e){u.push(o.getCircleStyle(e,n))})}o.data.buttonStyle!==u&&o.setData({buttonStyle:u})})},getCircleStyle:function(t,e){var a=this.data,n=a.sAngle,o=a.eAngle,r=a.duration,c=a.scale,i=this.data.buttons.length,s=Math.max,l=Math.sin,u=Math.cos,a=Math.PI,n=n*a/180,o=o*a/180,t=n+(o-n)/(o%(2*a)==0?i:s(1,i-1))*t,l=l(t)*e,e=u(t)*e,l=parseFloat(l.toFixed(6)),e=parseFloat(e.toFixed(6)),e="transform: scale(".concat(c,") translate3d(").concat(l,"px, ").concat(e,"px, 0)");return"opacity: 1; transition-duration: ".concat(r,"ms; ").concat(e)},bindgetuserinfo:function(t){this.triggerEvent("getuserinfo",_objectSpread(_objectSpread({},t.detail),t.currentTarget.dataset))},bindcontact:function(t){this.triggerEvent("contact",_objectSpread(_objectSpread({},t.detail),t.currentTarget.dataset))},bindgetphonenumber:function(t){this.triggerEvent("getphonenumber",_objectSpread(_objectSpread({},t.detail),t.currentTarget.dataset))},bindopensetting:function(t){this.triggerEvent("opensetting",_objectSpread(_objectSpread({},t.detail),t.currentTarget.dataset))},onError:function(t){this.triggerEvent("error",_objectSpread(_objectSpread({},t.detail),t.currentTarget.dataset))}},ready:function(){var t=this.data,e=t.defaultVisible,a=t.visible,t=t.controlled;this.updated(t?a:e)}});