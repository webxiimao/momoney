"use strict";var _baseComponent=_interopRequireDefault(require("../helpers/baseComponent")),_classNames=_interopRequireDefault(require("../helpers/classNames")),_index=_interopRequireDefault(require("./locales/index")),_props=require("./props");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function ownKeys(t,e){var a,r=Object.keys(t);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(t),e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,a)),r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(a),!0).forEach(function(e){_defineProperty(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _construct(e,t,a){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(e,t,a){var r=[null];r.push.apply(r,t);r=new(Function.bind.apply(e,r));return a&&_setPrototypeOf(r,a.prototype),r}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(a="Object"===a&&e.constructor?e.constructor.name:a)||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var DATETIME="datetime",DATE="date",TIME="time",MONTH="month",YEAR="year",ONE_DAY=864e5;function fomartArray(e,t){for(var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,r=e,n=[];r<=t;)n.push(r),r+=a;return n}function getDaysInMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()}function pad(e){return e<10?"0".concat(e):e+""}function cloneDate(e){return new Date(+e)}function setMonth(e,t){e.setDate(Math.min(e.getDate(),getDaysInMonth(new Date(e.getFullYear(),t)))),e.setMonth(t)}function valueToDate(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!Array.isArray(e))return"string"==typeof e&&(e=e.replace(/\-/g,"/")),isNaN(Number(e))||(e=Number(e)),new Date(e);var a=t.mode,r=t.use12Hours,n=new Date,i=n.getFullYear(),u=n.getMonth(),o=n.getDate(),s=e.map(function(e){return Number(e)});for(r&&[DATETIME,TIME].includes(a)&&(t=a===DATETIME?3:0,n=s.length-1,e=Number(s[n]),r=Number(s[t]),r=1===e?(r<=12&&(r+=12),24<=r?0:r):(12<(r=0===r?12:r)&&(r-=12),12<=r?0:r),s.splice(t,1,r),s.splice(n,1)),a===TIME?(s.unshift(o),s.unshift(u),s.unshift(i)):a===MONTH?s.push(o):a===YEAR&&(s.push(u),s.push(o));s.length<=6;)s.push(0);return _construct(Date,_toConsumableArray(s))}(0,_baseComponent.default)({properties:_props.props,data:{inputValue:[],options:[]},observers:_defineProperty({inputValue:function(){this.updatedCols()},value:function(e){this.setValue(e)}},"mode, minuteStep, use12Hours, minDate, maxDate, minHour, maxHour, minMinute, maxMinute, lang",function(){this.setValue(this.data.inputValue)}),methods:{getDefaultMinDate:function(){return this.defaultMinDate||(this.defaultMinDate=new Date(2e3,1,1,0,0,0)),this.defaultMinDate},getDefaultMaxDate:function(){return this.defaultMaxDate||(this.defaultMaxDate=new Date(2030,1,1,23,59,59)),this.defaultMaxDate},getMinDate:function(){return this.data.minDate?valueToDate(this.data.minDate,this.data):this.getDefaultMinDate()},getMaxDate:function(){return this.data.maxDate?valueToDate(this.data.maxDate,this.data):this.getDefaultMaxDate()},getDateMember:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"min",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"year",a={min:"getMinDate",max:"getMaxDate",year:"getFullYear",month:"getMonth",day:"getDate",hour:"getHours",minute:"getMinutes"};return this[a[e]]()[a[t]]()},getDisplayHour:function(e){return this.data.use12Hours&&12<(e=0===e?12:e)&&(e-=12),e},setHours:function(e,t){var a,r;this.data.use12Hours?(a=e.getHours(),r=t,e.setHours(r=24<=(r=12<=a?t+12:t)?0:r)):e.setHours(t)},setAmPm:function(e,t){0===t?e.setTime(+e-ONE_DAY/2):e.setTime(+e+ONE_DAY/2)},getNewDate:function(e,t){var a=parseInt(e[t],10),e=this.data.mode,r=cloneDate(this.getDate());if(e===DATETIME||e===DATE||e===YEAR||e===MONTH)switch(t){case 0:r.setFullYear(a);break;case 1:setMonth(r,a);break;case 2:r.setDate(a);break;case 3:this.setHours(r,a);break;case 4:r.setMinutes(a);break;case 5:this.setAmPm(r,a)}else if(e===TIME)switch(t){case 0:this.setHours(r,a);break;case 1:r.setMinutes(a);break;case 2:this.setAmPm(r,a)}return this.clipDate(r)},clipDate:function(e){var t=this.data.mode,a=this.getMinDate(),r=this.getMaxDate();if(t===DATETIME){if(e<a)return cloneDate(a);if(r<e)return cloneDate(r)}else if(t===DATE||t===YEAR||t===MONTH){if(+e+ONE_DAY<=a)return cloneDate(a);if(+r+ONE_DAY<=e)return cloneDate(r)}else if(t===TIME){var n=r.getHours(),i=r.getMinutes(),u=a.getHours(),o=a.getMinutes(),s=e.getHours(),t=e.getMinutes();if(s<u||s===u&&t<o)return cloneDate(a);if(n<s||s===n&&i<t)return cloneDate(r)}return e},getDate:function(e){e=e||this.data.value;return this.clipDate(e?valueToDate(e,this.data):this.getMinDate())},getDateData:function(e){var t=this.data,a=t.mode,r=t.lang,n=_index.default[r],i=e.getFullYear(),u=e.getMonth(),o=this.getDateMember("min","year"),s=this.getDateMember("max","year"),l=this.getDateMember("min","month"),c=this.getDateMember("max","month"),h=this.getDateMember("min","day"),f=this.getDateMember("max","day"),t=fomartArray(o,s).map(function(e){return{value:e+"",label:e+n.year+""}});if(a===YEAR)return[t];r=fomartArray(o===i?l:0,s===i?c:11).map(function(e){return{value:e+"",label:e+1+n.month+""}});return a===MONTH?[t,r]:[t,r,fomartArray(o===i&&l===u?h:1,s===i&&c===u?f:getDaysInMonth(e)).map(function(e){return{value:e+"",label:e+n.day+""}})]},getTimeData:function(e){var t,a,r,n,i,u=this.data,o=u.minHour,s=u.maxHour,l=u.minMinute,c=u.maxMinute,h=this.data,f=h.mode,m=h.minuteStep,p=h.use12Hours,D=h.lang,g=_index.default[D],d=this.getDateMember("min","minute"),y=this.getDateMember("max","minute"),b=this.getDateMember("min","hour"),M=this.getDateMember("max","hour"),v=e.getHours();f===DATETIME?(t=e.getFullYear(),a=e.getMonth(),r=e.getDate(),n=this.getDateMember("min","year"),i=this.getDateMember("max","year"),u=this.getDateMember("min","month"),h=this.getDateMember("max","month"),D=this.getDateMember("min","day"),f=this.getDateMember("max","day"),n===t&&u===a&&D===r&&(o=b)===v&&(l=d),i===t&&h===a&&f===r&&(s=M)===v&&(c=y)):((o=b)===v&&(l=d),(s=M)===v&&(c=y));y=[];0===o&&0===s||0!==o&&0!==s?o=this.getDisplayHour(o):0===o&&p&&(o=1,y.push({value:"0",label:g.hour?"12"+g.hour:"12"}));for(var s=this.getDisplayHour(s),y=[].concat(_toConsumableArray(y),_toConsumableArray(fomartArray(o,s).map(function(e){return{value:e+"",label:g.hour?e+g.hour+"":pad(e)}}))),_=[],A=e.getMinutes(),T=l;T<=c;T+=m)_.push({value:T+"",label:g.minute?T+g.minute+"":pad(T)}),T<A&&A<T+m&&_.push({value:A+"",label:g.minute?A+g.minute+"":pad(A)});l=[{value:"0",label:g.am},{value:"1",label:g.pm}];return[y,_].concat(p?[l]:[])},getValueCols:function(e){var t=this.data,a=t.mode,r=t.use12Hours,n=this.getDate(e),i=[],t=[];return a===YEAR?{cols:this.getDateData(n),value:[n.getFullYear()+""]}:a===MONTH?{cols:this.getDateData(n),value:[n.getFullYear()+"",n.getMonth()+""]}:(a!==DATETIME&&a!==DATE||(i=this.getDateData(n),t=[n.getFullYear()+"",n.getMonth()+"",n.getDate()+""]),a!==DATETIME&&a!==TIME||(i=i.concat(this.getTimeData(n)),n=[(e=n.getHours())+"",(a=n.getMinutes())+""],r&&(n=[(0===e?12:12<e?e-12:e)+"",a+"",(12<=e?1:0)+""]),t=t.concat(n)),{value:t,cols:i})},onValueChange:function(e){var t=e.detail,a=t.value,r=t.index,t=this.getNewDate(a,r),a=this.getValueCols(t),r=a.value,a=a.cols,a=this.getValue(r,a);this.triggerEvent("valueChange",_objectSpread(_objectSpread(_objectSpread({},e.detail),a),{},{date:+t}))},updatedCols:function(){var e=this.getValueCols().cols;this.setData({cols:e})},updated:function(e){this.data.inputValue!==e&&this.setData({inputValue:e})},setValue:function(){0<arguments.length&&void 0!==arguments[0]||this.data.inputValue;var e=this.getValueCols().value;this.updated(e)},getValue:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.data.inputValue,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.data.cols;return this.picker=this.picker||this.selectComponent("#wux-picker"),_objectSpread(_objectSpread({},this.picker.getValue(e,t)),{},{date:+this.getDate()})}},attached:function(){this.setValue(this.data.value)}});