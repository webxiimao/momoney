"use strict";var _baseComponent=_interopRequireDefault(require("../helpers/baseComponent")),_classNames=_interopRequireDefault(require("../helpers/classNames")),_arrayTreeFilter=_interopRequireDefault(require("../helpers/arrayTreeFilter"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(a="Object"===a&&e.constructor?e.constructor.name:a)||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var WUX_CASCADER="wux-cascader",defaultFieldNames={label:"label",value:"value",children:"children"};(0,_baseComponent.default)({externalClasses:["wux-scroll-view-class"],properties:{prefixCls:{type:String,value:"wux-cascader"},defaultValue:{type:Array,value:[]},value:{type:Array,value:[]},controlled:{type:Boolean,value:!1},title:{type:String,value:""},options:{type:Array,value:[]},chooseTitle:{type:String,value:"请选择"},visible:{type:Boolean,value:!1},defaultFieldNames:{type:Object,value:defaultFieldNames}},data:{activeOptions:[],activeIndex:0,bodyStyle:"",activeValue:[],showOptions:[],fieldNames:{}},computed:{classes:["prefixCls",function(e){return{wrap:(0,_classNames.default)(e),hd:"".concat(e,"__hd"),title:"".concat(e,"__title"),menus:"".concat(e,"__menus"),menu:"".concat(e,"__menu"),bd:"".concat(e,"__bd"),inner:"".concat(e,"__inner"),scrollView:"".concat(e,"__scroll-view"),option:"".concat(e,"__option"),item:"".concat(e,"__item"),icon:"".concat(e,"__icon"),ft:"".concat(e,"__ft")}}]},observers:{value:function(e){this.data.controlled&&(this.setData({activeValue:e}),this.getCurrentOptions(e))},options:function(){this.getCurrentOptions(this.data.activeValue)}},methods:{getActiveOptions:function(a){var e=this.data.options,n=this.getFieldName("value"),t=this.getFieldName("children");return(0,_arrayTreeFilter.default)(e,function(e,t){return e[n]===a[t]},{childrenKeyName:t})},getShowOptions:function(e){var t=this.data.options,a=this.getFieldName("children"),e=this.getActiveOptions(e).map(function(e){return e[a]}).filter(function(e){return!!e});return[t].concat(_toConsumableArray(e))},getMenus:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length?arguments[1]:void 0,a=this.data,n=(a.options,a.chooseTitle),i=this.getActiveOptions(e);return t&&(a=this.getFieldName("value"),e=this.getFieldName("label"),i.push((_defineProperty(t={},a,WUX_CASCADER),_defineProperty(t,e,n),t))),i},getNextActiveValue:function(e,t){var a=this.data.activeValue;return(a=a.slice(0,t+1))[t]=e,a},updated:function(e,t,a,n){var i=this.getFieldName("value"),r=this.getFieldName("children"),o=e[r]&&0<e[r].length,l=this.getNextActiveValue(e[i],t),s=this.getMenus(l,o),r=s.length-1,i=this.getShowOptions(l),r={activeValue:l,activeOptions:s,activeIndex:r,showOptions:i};(o||l.length===i.length&&(t=Math.max(0,t-1)))&&(r.bodyStyle="transform: translate(".concat(-50*t,"%)"),r.showOptions=i),a&&this.setData(r),"function"==typeof n&&n.call(this,e,s,!o)},getCurrentOptions:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.data.activeValue,a=Math.max(0,t.length-1),n=this.getActiveOptions(t),i=n[a];i?this.updated(i,a,!0):(e=this.getFieldName("value"),i=this.getFieldName("label"),n.push((_defineProperty(a={},e,WUX_CASCADER),_defineProperty(a,i,this.data.chooseTitle),a)),a=this.getShowOptions(t),t=n.length-1,this.setData({showOptions:a,activeOptions:n,activeIndex:t,bodyStyle:""}))},onMenuClick:function(e){var t=e.currentTarget.dataset.menuIndex,e="transform: translate(".concat(-50*(1<t?t-1:0),"%)");this.setData({bodyStyle:e,activeIndex:t})},onItemSelect:function(e){var t=e.currentTarget.dataset,e=t.item,t=t.optionIndex;e&&!e.disabled&&this.updated(e,t,!this.data.controlled,this.onChange)},onPopupClose:function(){this.triggerEvent("close")},onChange:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=a.filter(function(e){return e[t.getFieldName("value")]!==WUX_CASCADER}),a=i.map(function(e){return e[t.getFieldName("value")]});if(!1===e.isLeaf&&!e.children)return this.emitEvent({value:a,options:i,done:!1}),void this.triggerEvent("load",{value:a,options:i});this.emitEvent({value:a,options:i,done:n})},emitEvent:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.triggerEvent("change",e),e.done&&this.onPopupClose()},getFieldName:function(e){return this.data.fieldNames[e]}},attached:function(){var e=this.data,t=e.defaultValue,a=e.value,a=e.controlled?a:t,t=Object.assign({},defaultFieldNames,this.data.defaultFieldNames);this.setData({activeValue:a,fieldNames:t}),this.getCurrentOptions(a)}});