"use strict";var _baseComponent=_interopRequireDefault(require("../helpers/baseComponent")),_classNames=_interopRequireDefault(require("../helpers/classNames"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var toAngle=function(e){return e/180*Math.PI},percent=function(e){return toAngle(e/100*360)},easeInOutCubic=function(e,t,n,a){return(e/=a/2)<1?n/2*e*e*e+t:n/2*((e-=2)*e*e+2)+t};(0,_baseComponent.default)({properties:{prefixCls:{type:String,value:"wux-circle"},percent:{type:Number,value:0,observer:"redraw"},strokeWidth:{type:Number,value:10},size:{type:Number,value:120,observer:"updateStyle"},lineCap:{type:String,value:"round"},backgroundColor:{type:String,value:"#f3f3f3"},color:{type:String,value:"#33cd5f"},sAngle:{type:Number,value:0,observer:function(e){this.setData({beginAngle:toAngle(e)})}},counterclockwise:{type:Boolean,value:!1},speed:{type:Number,value:2e3},animate:{type:Boolean,value:!0},background:{type:Boolean,value:!0}},data:{beginAngle:0,startAngle:0,endAngle:0,currentAngle:0},computed:{classes:["prefixCls",function(e){return{wrap:(0,_classNames.default)(e),inner:"".concat(e,"__inner")}}]},methods:{updateStyle:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.data.size,e="width: ".concat(e,"px; height: ").concat(e,"px;");this.setData({style:e})},redraw:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.data.percent,n=percent(t),a=Date.now(),i=this.data.currentAngle>n,t=i?this.data.endAngle:this.data.currentAngle;this.cancelNextCallback(),this.clearTimer(),this.safeSetData({startAngle:t,endAngle:n},function(){e.animate(a,a,i)})},draw:function(){var e=this,t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],n=this.data,a=n.lineCap,i=n.backgroundColor,r=n.color,s=n.size,c=n.strokeWidth,l=n.counterclockwise,u=n.background,o=s/2,h=o-c/2,d=2*Math.PI,n=l?d-this.data.beginAngle:this.data.beginAngle,d=l?d-(this.data.beginAngle+this.data.currentAngle):this.data.beginAngle+this.data.currentAngle;this.ctx=this.ctx||wx.createCanvasContext("circle",this),this.ctx.clearRect(0,0,s,s),u&&(this.ctx.beginPath(),this.ctx.arc(o,o,h,0,2*Math.PI),this.ctx.setLineWidth(c),this.ctx.setStrokeStyle(i),this.ctx.stroke()),t&&(this.ctx.beginPath(),this.ctx.arc(o,o,h,n,d),this.ctx.setLineWidth(c),this.ctx.setStrokeStyle(r),this.ctx.setLineCap(a),this.ctx.stroke()),this.ctx.draw(!1,function(){e.triggerEvent("change",{value:e.data.currentAngle})})},animate:function(e,t,n){var a,i=this,r=Date.now(),s=r-e<1?1:r-e,c=this.data,l=c.animate,u=c.speed,r=c.startAngle,o=c.endAngle,c=!n&&1e3*this.data.currentAngle<=Math.floor(1e3*o)||n&&1e3*this.data.currentAngle>=Math.floor(1e3*o);l&&e-t<1.05*u&&c?(s=easeInOutCubic((e-t)/s,r,o-r,u/s),a=s<0?0:s,e=Date.now(),this.safeSetData({currentAngle:a},function(){i.draw(0!==a),i.timer=setTimeout(function(){return i.animate(e,t,n)},1e3/60)})):this.safeSetData({currentAngle:o},function(){return i.draw(0!==o)})},clearTimer:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)}},attached:function(){this.updateStyle(),0===this.data.percent&&this.draw(!1)},detached:function(){this.ctx=null,this.clearTimer()}});