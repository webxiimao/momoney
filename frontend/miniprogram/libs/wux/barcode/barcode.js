"use strict";var pluginName=null,EAN13=function(){function t(t,i,e,s){if(this.id=t,this.number=i,this.ctx=s,this.settings={width:200,height:100,number:!0,prefix:!0,color:"black",debug:!1,onValid:function(){},onInvalid:function(){},onSuccess:function(){},onError:function(){}},e)for(var n in e)this.settings[n]=e[n];this._name=pluginName,this.init()}return t.prototype.settings={},t.prototype.init=function(){var t;return 12===this.number.length&&(t=this.generateCheckDigit(this.number),this.number+=t),13===this.number.length?((this.validate()?this.settings.onValid:this.settings.onInvalid).call(),t=this.getCode(),this.draw(t)):this.settings.onError.call()},t.prototype.getCode=function(){for(var t=["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],i=["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"],e=["1110010","1100110","1101100","1000010","1011100","1001110","1010000","1000100","1001000","1110100"],s="",n=["xxxxxx","xxyxyy","xxyyxy","xxyyyx","xyxxyy","xyyxxy","xyyyxx","xyxyxy","xyxyyx","xyyxyx"][parseInt(this.number.substr(0,1),10)].split(""),r=this.number.substr(1).split(""),h=0;h<6;)"x"===n[h]?s+=t[r[h]]:s+=i[r[h]],h++;for(h=6;h<12;)s+=e[r[h]],h++;return s},t.prototype.clear=function(t){return t.clearRect(0,0,this.settings.width,this.settings.height)},t.prototype.draw=function(t){var e,s,i,n,r,h,o,f,l,u={prefix_offset:.06,font_stretch:.073,border_line_height_number:.9,border_line_height:1,line_height:.9,font_size:.15,font_y:1.03,text_offset:4.5},x=this.settings.prefix?this.settings.width-this.settings.width*u.prefix_offset:this.settings.width,c=this.settings.number?(e=u.border_line_height_number*this.settings.height,u.line_height*e):e=u.border_line_height*this.settings.height,g=x/95;if(this.id){for(s=wx.createCanvasContext(this.id,this.ctx),this.clear(s),s.setFillStyle(this.settings.color),n=this.settings.number&&this.settings.prefix?this.settings.width*u.prefix_offset:0,r=t.split(""),s.fillRect(n,0,g,e),s.fillRect(n+=2*g,0,g,e),n+=g,i=0;i<42;)"1"===r[i]&&s.fillRect(n,0,Math.floor(g)+1,c),n+=g,i++;for(s.fillRect(n+=g,0,g,e),s.fillRect(n+=2*g,0,g,e),n+=2*g,i=42;i<84;)"1"===r[i]&&s.fillRect(n,0,Math.floor(g)+1,c),n+=g,i++;if(s.fillRect(n,0,g,e),s.fillRect(n+=2*g,0,g,e),this.settings.number&&(s.setFontSize(u.font_size*c+"px monospace"),t=this.number.substr(0,1),this.settings.prefix&&s.fillText(t,0,e*u.font_y),h=g*u.text_offset+(this.settings.prefix?u.prefix_offset*this.settings.width:0),this.number.substr(1,6).split("").forEach(function(t,i){return s.fillText(t,h,e*u.font_y),h+=u.font_stretch*x}),h=49*g+(this.settings.prefix?u.prefix_offset*this.settings.width:0)+u.text_offset,this.number.substr(7).split("").forEach(function(t,i){return s.fillText(t,h,e*u.font_y),h+=u.font_stretch*x})),this.settings.debug)for(o=f=0,l=2*g;0<l?f<=x:x<=f;o=f+=l)s.beginPath(),s.rect(o,.4*c,g,.1*c),s.setFillStyle("red"),s.fill();return s.draw(),this.settings.onSuccess.call()}return this.settings.onError.call()},t.prototype.generateCheckDigit=function(t){var e=0;return t.split("").forEach(function(t,i){return e+=i%2==0?parseInt(t,10):3*parseInt(t,10)}),10-e%10%10},t.prototype.validate=function(){return parseInt(this.number.slice(-1),10)===this.generateCheckDigit(this.number.slice(0,-1))},t}();"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=EAN13);