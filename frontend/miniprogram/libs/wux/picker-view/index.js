"use strict";var _observers,_baseComponent=_interopRequireDefault(require("../helpers/baseComponent")),_classNames2=_interopRequireDefault(require("../helpers/classNames")),_shallowEqual=_interopRequireDefault(require("../helpers/shallowEqual")),_styleToCssString=_interopRequireDefault(require("../helpers/styleToCssString")),_gestures=require("../helpers/gestures"),_checkIPhoneX=require("../helpers/checkIPhoneX"),_props=require("./props"),_utils=require("./utils");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperty(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function getStyles(t){return Array.isArray(t)?t.map(function(t){return(0,_styleToCssString.default)(t)}):(0,_styleToCssString.default)(t)}(0,_baseComponent.default)({properties:_props.props,data:{inputValue:null,selectedIndex:null,selectedValue:null,cols:[],extIndicatorStyle:"",extItemStyle:"",extMaskStyle:"",contentStyle:"",fieldNames:_props.defaultFieldNames,itemCount:7,styles:{}},computed:{classes:["prefixCls, labelAlign",function(t,e){return{wrap:(0,_classNames2.default)(t,_defineProperty({},"".concat(t,"--").concat(e),e)),mask:"".concat(t,"__mask"),indicator:"".concat(t,"__indicator"),content:"".concat(t,"__content"),item:"".concat(t,"__item")}}]},observers:(_defineProperty(_observers={itemHeight:function(t){this.updatedStyles(t)},itemStyle:function(t){this.setData({extItemStyle:getStyles(t)})},indicatorStyle:function(t){this.setData({extIndicatorStyle:getStyles(t)})},maskStyle:function(t){this.setData({extMaskStyle:getStyles(t)})}},"value, options",function(t,e){var s=this.data.controlled,i=Object.assign({},_props.defaultFieldNames,this.data.defaultFieldNames),i=(0,_utils.getRealCol)(e,i);(0,_shallowEqual.default)(this.data.cols,i)||this.setData({cols:i}),s&&this.setValue(t,!0)}),_defineProperty(_observers,"inputValue",function(t){var e=this.getValue(t),t=e.selectedIndex,e=e.selectedValue;this.setData({selectedIndex:t,selectedValue:e})}),_observers),methods:{updatedStyles:function(t){var e=this.data.itemCount;e%2==0&&e--,e--,e/=2;var s="height: ".concat(t*this.data.itemCount,"px;"),i="line-height: ".concat(t,"px; height: ").concat(t,"px;"),a="padding: ".concat(t*e,"px 0;"),l="top: ".concat(t*e,"px; height: ").concat(t,"px;"),e="background-size: 100% ".concat(t*e,"px;");this.setData({styles:{wrap:s,item:i,content:a,indicator:l,mask:e}})},updated:function(t,e){var s=this;this.data.inputValue===t&&!e||this.setData({inputValue:t}),e&&this.select(t,this.data.itemHeight,function(t){return s.scrollTo(t,0,!1)})},setValue:function(t,e){t=this.getValue(t).value;this.updated(t,e)},getValue:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.data.inputValue,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.data.cols,s=this.data.fieldNames,i=(0,_utils.getRealValue)(t,e,s)||null,a=i,t=(0,_utils.getIndexFromValue)(t,e,s);return{value:i,displayValue:(0,_utils.getLabelFromIndex)(t,e,s.label),selectedIndex:t,selectedValue:a,cols:e}},scrollTo:function(t){var e=this,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.3,i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];this.scrollY!==t&&(this.runCallbacks&&(clearTimeout(this.runCallbacks),this.runCallbacks=null),this.scrollY=t,this.setTransform(-t,s,function(){i&&(e.runCallbacks=setTimeout(function(){e.setTransform(-t,0,e.scrollingComplete)},1e3*+s))}))},onFinish:function(){var e=this;this.isMoving=!1;var t=this.scrollY,s=this.data,i=s.cols,s=s.itemHeight,i=(i.length-1)*s;(t=t%s!=0?Math.round(t/s)*s:t)<0?t=0:i<t&&(t=i);i=this.getChildMeta(t,s);i&&!i.disabled?this.scrollTo(t,.3):this.select(this.data.inputValue,s,function(t){return e.scrollTo(t,0,!1)}),this.onScrollChange()},onTouchStart:function(t){1<(0,_gestures.getPointsNumber)(t)||(this.isMoving=!0,this.startY=(0,_gestures.getTouchPoints)(t).y,this.lastY=this.scrollY,this.triggerEvent("beforeChange",this.getValue()))},onTouchMove:function(t){!this.isMoving||1<(0,_gestures.getPointsNumber)(t)||(this.scrollY=this.lastY-(0,_gestures.getTouchPoints)(t).y+this.startY,this.setTransform(-this.scrollY,!1,this.onScrollChange))},onTouchEnd:function(t){1<(0,_gestures.getPointsNumber)(t)||this.onFinish()},onItemClick:function(t){var e=t.currentTarget.dataset,t=e.index;e.disabled||this.scrollTo(t*this.data.itemHeight)},setTransform:function(t,e,s){e={transform:"translate3d(0,".concat(t,"px,0)"),transition:e?"cubic-bezier(0, 0, 0.2, 1.15) ".concat(e,"s"):"none"};this.setData({contentStyle:(0,_styleToCssString.default)(e)},s)},select:function(t,e,s){var i=this.data,a=i.cols,i=i.fieldNames,i=(0,_utils.getIndexFromValue)(t,a,i);this.selectByIndex(i,e,s)},selectByIndex:function(t,e,s){t<0||t>=this.data.cols.length||!e||s.call(this,t*e)},computeChildIndex:function(t,e,s){e=Math.round(t/e);return Math.min(e,s-1)},getChildMeta:function(t,e){var s=this.data,i=s.cols;s.fieldNames;return i[this.computeChildIndex(t,e,i.length)]},scrollingComplete:function(){var t,e,s=this.scrollY;0<=s&&(t=(e=this.data).itemHeight,e=e.fieldNames,(t=this.getChildMeta(s,t))&&(e=t[e.value],this.data.inputValue!==e&&this.fireValueChange(e)))},onScrollChange:function(){var t,e,s,i=this.scrollY;0<=i&&(t=(s=this.data).cols,e=s.itemHeight,s=s.fieldNames,e=this.computeChildIndex(i,e,t.length),this.scrollValue!==e&&((e=t[this.scrollValue=e])&&(s=this.getValue(e[s.value]),this.triggerEvent("scrollChange",s)),this.vibrateShort()))},fireValueChange:function(t){this.data.controlled||this.updated(t),this.triggerEvent("valueChange",this.getValue(t)),this.vibrateShort()}},created:function(){var t=(0,_checkIPhoneX.getSystemInfo)();this.vibrateShort=function(){"devtools"!==t.platform&&wx.vibrateShort()},this.scrollValue=void 0,this.scrollY=-1,this.lastY=0,this.startY=0,this.isMoving=!1},attached:function(){var t=this.data,e=t.defaultValue,s=t.value,i=t.controlled,a=t.options,t=t.itemHeight,s=i?s:e,e=Object.assign({},_props.defaultFieldNames,this.data.defaultFieldNames),a=(0,_utils.getRealCol)(a,e);this.updatedStyles(t),this.setData({cols:a,fieldNames:e}),this.setValue(s,!0)}});