"use strict";var _baseComponent=_interopRequireDefault(require("../helpers/baseComponent")),_classNames2=_interopRequireDefault(require("../helpers/classNames")),_eventsMixin=_interopRequireDefault(require("../helpers/eventsMixin"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(a="Object"===a&&e.constructor?e.constructor.name:a)||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}(0,_baseComponent.default)({behaviors:[(0,_eventsMixin.default)()],relations:{"../field/index":{type:"ancestor"}},properties:{prefixCls:{type:String,value:"wux-rater"},max:{type:Number,value:5,observer:function(){this.setValue(this.data.inputValue)}},icon:{type:String,value:""},star:{type:String,value:"â˜…"},defaultValue:{type:Number,value:0},value:{type:Number,value:0,observer:function(e){this.data.controlled&&this.setValue(e)}},activeColor:{type:String,value:"#ffc900"},margin:{type:Number,value:2},fontSize:{type:Number,value:25},disabled:{type:Boolean,value:!1},allowHalf:{type:Boolean,value:!1},allowClear:{type:Boolean,value:!1},allowTouchMove:{type:Boolean,value:!1},controlled:{type:Boolean,value:!1}},data:{inputValue:0},computed:{classes:["prefixCls, disabled",function(e,t){return{wrap:(0,_classNames2.default)(e,_defineProperty({},"".concat(e,"--disabled"),t)),star:"".concat(e,"__star"),box:"".concat(e,"__box"),inner:"".concat(e,"__inner"),outer:"".concat(e,"__outer"),icon:"".concat(e,"__icon")}}]},observers:_defineProperty({},"inputValue, max, activeColor",function(r,e,n){var t=_toConsumableArray(new Array(e)).map(function(e,t){return t}),a=t.reduce(function(e,t,a){return[].concat(_toConsumableArray(e),[a<=r-1?n:"#ccc"])},[]),e=r.toString().split("."),e=1===e.length?[e[0],0]:e;this.setData({stars:t,colors:a,cutIndex:+e[0],cutPercent:10*e[1]})}),methods:{updated:function(e){this.hasFieldDecorator||this.data.inputValue!==e&&this.setData({inputValue:e})},setValue:function(e){var t=this.data.max;this.updated(e<=0?0:t<e?t:e)},updateHalfStarValue:function(a,r,n){var o=this,e=this.data.prefixCls;wx.createSelectorQuery().in(this).selectAll(".".concat(e,"__star")).boundingClientRect(function(e){var t;e.filter(function(e){return!e}).length||(e=(t=e[a]).left,t=t.width,n.call(o,r-e<t/2?a+.5:a+1,a))}).exec()},onTap:function(e){var a=this,t=e.currentTarget.dataset.index,r=this.data,n=r.inputValue,o=r.disabled,i=r.allowHalf,l=r.allowClear;o||(i?this.updateHalfStarValue(t,e.detail.x,function(e,t){a.onChange(l&&e===n?0:e,t)}):(e=t+1,this.onChange(l&&e===n?0:e,t)))},onChange:function(e,t){this.data.controlled||this.setValue(e),this.triggerEvent("change",{value:e,index:t})},onTouchMove:function(e){var n,o=this,t=this.data,a=t.disabled,i=t.allowHalf,t=t.allowTouchMove;!a&&t&&(n=e.changedTouches[0].pageX,e=this.data.prefixCls,wx.createSelectorQuery().in(this).selectAll(".".concat(e,"__star")).boundingClientRect(function(e){var t,a,r;e.filter(function(e){return!e}).length||(t=(a=e[0]).left,r=a.width,a=e.map(function(e){return e.width}).reduce(function(e,t){return e+t}),t=n-t,r=Math.ceil(t/r),0<t&&t<a&&(a=r-1,i&&(e=e[a],r=n-e.left<e.width/2?r-.5:r),o.onChange(r,a)))}).exec())}},attached:function(){var e=this.data,t=e.defaultValue,a=e.value,e=e.controlled;this.setValue(e?a:t)}});