"use strict";var _defaults,_baseComponent=_interopRequireDefault(require("../helpers/baseComponent")),_classNames=_interopRequireDefault(require("../helpers/classNames")),_gestures=require("../helpers/gestures");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function ownKeys(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)),r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var defaults=(_defineProperty(_defaults={prefixCls:"wux-gallery",classNames:"wux-animate--slideInRight",indicatorDots:!1,indicatorColor:"rgba(0, 0, 0, .3)",indicatorActiveColor:"#000000",autoplay:!1,interval:5e3,duration:500,circular:!1,vertical:!1,icon:"",showDelete:!0,allowScale:!0,current:0,urls:[]},"delete",function(){}),_defineProperty(_defaults,"cancel",function(){}),_defineProperty(_defaults,"onChange",function(){}),_defineProperty(_defaults,"onTap",function(){return!0}),_defaults),MIN_RATIO=1,MAX_RATIO=1.2,defaultTouchOptions={scale:1,offset:[.5,3]},getImages=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).map(function(t){return"object"!==_typeof(t)?{image:t,remark:"",touch:_objectSpread({},defaultTouchOptions)}:_objectSpread(_objectSpread({},t),{},{touch:_objectSpread({},defaultTouchOptions)})})};(0,_baseComponent.default)({useFunc:!0,data:defaults,computed:{classes:["prefixCls",function(t){return{swiper:"".concat(t,"__swiper"),item:"".concat(t,"__item"),img:"".concat(t,"__img"),remark:"".concat(t,"__remark"),opr:"".concat(t,"__opr"),del:"".concat(t,"__del"),icon:"".concat(t,"__icon")}}]},methods:{hide:function(){this.$$setData({in:!1}),"function"==typeof this.fns.cancel&&this.fns.cancel()},show:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this.$$mergeOptionsAndBindMethods(Object.assign({},defaults,t,{images:getImages(t.urls)}));this.$$setData(_objectSpread({in:!0},t))},onTap:function(t){this.allowItemClick&&(t=t.currentTarget.dataset.index,!0===this.fns.onTap(t,this.data.urls)&&this.hide())},onTouchStart:function(t){if(this.allowItemClick=!0,!this.data.allowScale||1===(0,_gestures.getPointsNumber)(t)||this.touching)return!1;var e=(0,_gestures.getTouchPoints)(t),t=(0,_gestures.getTouchPoints)(t,1),t=(0,_gestures.getPointsDistance)(e,t);this.touching=!1,this.prevDistance=t,this.$$setData({transition:"none"})},onTouchMove:function(t){var e=this;if(!this.data.allowScale||1===(0,_gestures.getPointsNumber)(t)||this.isRendered)return!1;var n=(0,_gestures.getTouchPoints)(t),r=(0,_gestures.getTouchPoints)(t,1),o=(0,_gestures.getPointsDistance)(n,r),n=t.currentTarget.dataset,r=n.touch,t=n.index,n=o-this.prevDistance,n=r.scale+.005*n;if(t!==this.data.current)return!1;n<=r.offset[0]*MIN_RATIO?n=r.offset[0]*MIN_RATIO:n>=r.offset[1]*MAX_RATIO&&(n=r.offset[1]*MAX_RATIO);n=_defineProperty({},"images[".concat(t,"].touch.scale"),n);this.touching||(this.touching=!0),this.prevDistance=o,this.allowItemClick=!1,this.isRendered=!0,this.$$setData(n).then(function(){return e.isRendered=!1})},onTouchEnd:function(t){var e=this;if(!this.data.allowScale||!this.touching)return!1;var n=t.currentTarget.dataset,r=n.touch,t=n.index,n=r.scale;n<=1?n=1:n>=r.offset[1]*MAX_RATIO&&(n=r.offset[1]);_defineProperty(r={},"images[".concat(t,"].touch.scale"),n),_defineProperty(r,"transition","transform .3s");this.touching=!1,this.$$setData(r).then(function(){setTimeout(function(){return e.allowItemClick=!0},400)})},onDelete:function(t){"function"==typeof this.fns.delete&&!0===this.fns.delete(this.data.current,this.data.urls)&&this.hide()},onChange:function(t){this.$$setData({current:t.detail.current}),"function"==typeof this.fns.onChange&&this.fns.onChange.call(this,t)},slideTo:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=this.data,o=r.urls,r=r.circular,o=o.length-1;return e<0?e=r?o:0:o<e&&(e=r?0:o),0<n?this.$$requestAnimationFrame(function(){return t.$$setData({current:e})},n):this.$$setData({current:e})},slideNext:function(t){return this.slideTo(this.data.current+1,t)},slidePrev:function(t){return this.slideTo(this.data.current-1,t)}}});